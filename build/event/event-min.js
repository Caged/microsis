MICROSIS.util.CustomEvent=Class.create({initialize:function(A,B){this.name=A;this.scope=B||window;this.subscribers=[];this.lastError=null},subscribe:function(B,A){if(!B){throw new Error("Invalid callback for "+this.name)}this.subscribers.push(new MICROSIS.util.Subscriber(B,A))},unsubscribe:function(C,B){if(!C){return this.cancelSubscriptions()}var A=false;this.subscribers.each(function(E,D){if(E&&E.isComposedOf(C,B)){this._unset(D);A=true}}.bind(this));return A},fire:function(){var D=this.subscribers.length,C=$A(arguments),B=true,A=false;if(isNaN(D)){return true}if(D==0){A=true}this.subscribers.each(function(E){try{console.log("ARGS INTERNAL",C);B=E.method.call(this.scope,C.first(),E.obj)}catch(F){this.lastError=F}if(B===false){return false}}.bind(this));if(A){this.subscribers=this.subscribers.compact()}return true},_unset:function(A){var B=this.subscribers[A];if(B){delete B.method;delete B.obj}this.subscribers[A]=null}});MICROSIS.util.Subscriber=Class.create({initialize:function(B,A){this.method=B;this.obj=A},isComposedOf:function(B,A){if(A){return(this.method==B&&this.obj==A)}else{return(this.method==B)}}});MICROSIS.util.EventProvider={__events:null,__subscribers:null,subscribe:function(A,E,D){this.__events=this.__events||{};var B=this.__events[A];if(B){B.subscribe(E,D)}else{var C=this.__subscribers=this.__subscribers||{};if(!C[A]){C[A]=[]}C[A].push({method:E,obj:D})}},unsubscribe:function(C,A,F){this.__events=this.__events||{};var I=this.__events;if(C){var H=I[C];if(H){return H.unsubscribe(A,F)}}else{var G=true;var E=!!Object.prototype.hasOwnProperty,D=null;for(var B in I){if(E){D=I.hasOwnProperty(B)}else{D=!Object.isUndefined(I[B])&&I.constructor.prototype[B]!==I[B]}if(D){G=G&&I[B].unsubscribe(A,F)}}return G}return false},cancelSubscriptions:function(A){return this.unsubscribe(A)},createEvent:function(B,A){var C=this.__events=this.__events||{};var H=this.__subscribers=this.__subscribers||{};var G=A||{};if(Object.isUndefined(C[B])){var F=G.scope||this;var E=new MICROSIS.util.CustomEvent(B,F);C[B]=E;var D=H[B];if(D){D.each(function(I){E.subscribe(I.method,I.obj)})}}return C[B]},fireEvent:function(B){var A=$A(arguments);var C=this.__events=this.__events||{};var D=C[B];if(!D){return null}return D.fire.apply(D,A)}}